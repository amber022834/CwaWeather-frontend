

<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flaneurå¤©æ°£é å ±"</title>
    <link rel="icon" type="image/png" href="images/sun.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        /* 1. æ•´é«”é…è‰²æ–¹æ¡ˆ - æ‘©è˜­è¿ªè³ªæ„Ÿé¢¨ */
        :root {
            --main-color: #F5F1EC;
            --secondary-color: #A78C70;
            --bg-color: #FAF8F3;
            --text-color: #5C4632;
            --button-color: #C4A484;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Noto Serif TC', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 10vh;
            overflow-x: hidden;
        }

        h1, h2, h3, .hero-desc, .hero-temp {
            font-family: 'Noto Serif TC', serif;
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInAndFloat {
            from {
                opacity: 0;
                transform: translate(-50%, -30%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(167, 140, 112, 0.1);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
        }

        .location-select {
            font-size: 1rem;
            padding: 6px 12px;
            border-radius: 12px;
            border: 2px solid var(--secondary-color);
            background-color: var(--main-color);
            color: var(--text-color);
            font-weight: 700;
            appearance: none;
            cursor: pointer;
        }

        .update-pill {
            font-size: 0.85rem;
            color: var(--text-color);
            background: var(--main-color);
            padding: 6px 14px;
            border-radius: 15px;
            font-family: 'Noto Sans TC', sans-serif;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .container {
            padding: 0 20px 30px 20px;
            margin: 0 auto;
        }

        .banner-container {
            width: 100vw;
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            height: 0;
            padding-bottom: 35%;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(92, 70, 50, 0.15);
            opacity: 0;
            animation: fadeInSlideUp 0.8s ease-out forwards;
        }

        .banner-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .banner-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            color: white;
            font-family: Arial, sans-serif;
            font-size: clamp(1.8rem, 8vw, 3.5rem);
            font-weight: 700;
            text-shadow: 0 0 5px rgba(99, 97, 97, 0.8), 0 0 20px rgba(0, 0, 0, 0.5);
            white-space: nowrap;
            opacity: 0;
            animation: fadeInAndFloat 1.5s ease-out 1s forwards;
        }

        .hero-card {
            background: var(--main-color);
            border-radius: 30px 20px 30px 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            position: relative;
            transition: transform 0.3s ease;
            opacity: 0;
        }

        .hero-card.animate {
            animation: fadeInSlideUp 0.8s ease-out 0.2s forwards;
        }

        .hero-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 18px rgba(0, 0, 0, 0.08);
        }

        .hero-period {
            position: absolute;
            top: -12px;
            left: 20px;
            transform: none;
            background: var(--secondary-color);
            color: var(--bg-color);
            padding: 4px 18px;
            border-radius: 18px;
            font-weight: 700;
            border: 3px solid var(--bg-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-family: 'Noto Sans TC', sans-serif;
        }

        .hero-temp-container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 15px;
            padding-left: 10px;
            margin-top: 40px;
        }

        .hero-icon {
            font-size: 5rem;
        }

        .hero-temp {
            font-size: 4rem;
            font-weight: 700;
            color: var(--text-color);
        }

        @media (min-width: 768px) {
            .hero-card {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                align-items: flex-start;
            }

            .hero-temp-container {
                flex: 1;
                padding-left: 0;
                margin-top: 0;
                align-items: center;
                order: 1;
                justify-content: flex-start;
            }

            .hero-icon {
                font-size: 6rem;
            }

            .hero-temp {
                font-size: 5rem;
            }

            .hero-desc {
                flex-basis: 100%;
                order: 3;
                text-align: left;
                padding-left: 0;
                font-size: 1.5rem;
                margin-top: 10px;
            }

            .mood-text {
                flex: 1 1 50%;
                margin-top: 20px;
                order: 4;
            }

            .advice-grid {
                flex: 1 1 50%;
                margin-top: 20px;
                order: 5;
            }
        }

        .hero-desc {
            text-align: left;
            padding-left: 10px;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .mood-text {
            font-family: 'Noto Sans TC', sans-serif;
            font-style: italic;
            font-size: 1rem;
            color: var(--button-color);
            margin: 15px 10px;
            padding: 5px 15px;
            border: 1px dashed rgba(196, 164, 132, 0.5);
            display: block;
            text-align: left;
            border-radius: 10px;
            line-height: 1.4;
        }

        .mood-text span {
            vertical-align: middle;
            margin-right: 5px;
            font-size: 1.2em;
        }

        .advice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .advice-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(196, 164, 132, 0.1);
            padding: 10px;
            border-radius: 15px;
            font-size: 0.95rem;
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 500;
            color: var(--text-color);
        }

        .section-title {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: left;
            margin: 25px 0 12px 0;
            color: var(--secondary-color);
            border-left: 6px solid var(--button-color);
            padding-left: 10px;
            opacity: 0;
            animation: fadeInSlideUp 0.8s ease-out 0.4s forwards;
        }

        .scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
            opacity: 0;
        }

        .scroll-container.animate {
            animation: fadeInSlideUp 0.8s ease-out 0.6s forwards;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        .mini-card {
            min-width: 120px;
            background: var(--main-color);
            border-radius: 15px 25px 15px 25px;
            padding: 15px;
            text-align: center;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(167, 140, 112, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .mini-card:hover {
            transform: translateY(-2px) scale(1.09);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .mini-time {
            font-size: 0.8rem;
            margin-bottom: 6px;
            background: var(--button-color);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            display: inline-block;
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 500;
        }

        .mini-icon {
            font-size: 2.2rem;
            margin: 4px 0;
        }

        .mini-temp {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
    </style>
</head>

<body>
    <div id="loading" class="loading-screen">
        <div style="font-size: 4rem; color: var(--secondary-color);">ğŸŒ¤ï¸</div>
        <p style="color: var(--text-color); font-weight: bold; margin-top: 20px;">æ­£åœ¨è§€æ¸¬é›²çš„æµå‹•...</p>
    </div>

    <div class="status-bar">
        <select id="citySelect" class="location-select" title="é¸æ“‡ä½ çš„é§è¶³åœ°">
            <option value="taipei">è‡ºåŒ— - é§è¶³ä¸­â–¾</option>
            <option value="taichung">è‡ºä¸­</option>
            <option value="tainan">è‡ºå—</option>
        </select>
        <div id="updateTime" class="update-pill">æ›´æ–°ä¸­...</div>
    </div>

    <div class="container" id="mainContent" style="display:none;">
        <div class="banner-container">
            <img id="bannerImg" class="banner-img" src="images/dominik-schroder-FIKD9t5_5zQ-unsplash.jpg" 
                 alt="ç¾éº—çš„éº¥ç”°é¢¨æ™¯" title="æ–‡é’æ„Ÿæ°£è±¡åœ–">
            <div id="bannerText" class="banner-text">
                <p>Hello, how are you?</p>
            </div>
        </div>

        <div id="heroCard"></div>
        <h3 class="section-title">æœªä¾†çš„å°ç·šç´¢</h3>
        <div class="scroll-container" id="futureForecasts"></div>
    </div>

    <script>
        const cityMap = {
            taipei: "https://weather-forcast.zeabur.app/api/weather/taipei",
            taichung: "https://weather-forcast.zeabur.app/api/weather/taichung",
            tainan: "https://weather-forcast.zeabur.app/api/weather/tainan"
        };

        function getMoodText(weather) {
            if (!weather) return "<span>âœ¨</span>éœéœæ„Ÿå—ä»Šæ—¥æ°›åœã€‚";
            if (weather.includes("æ™´")) return "<span>â˜€ï¸</span>é™½å…‰æ­£å¥½ï¼Œé©åˆå‡ºé–€èµ°èµ°ï¼Œè¸é’äº†ï¼";
            if (weather.includes("é›¨")) return "<span>â˜”</span>ä¸–ç•Œæ›ä¸Šæ¿¾é¡ï¼Œå®¤å…§é€›é€›æˆ–è®€æœ¬æ›¸ä¹Ÿä¸éŒ¯ã€‚";
            if (weather.includes("é™°")) return "<span>â˜ï¸</span>å¾®é¢¨å¹æ‹‚ï¼Œæ˜¯å€‹èˆ’é©å®œäººçš„å¥½å¤©æ°£å‘¢ã€‚";
            if (weather.includes("å¤šé›²")) return "<span>â›…</span>é›²æœµç·©ç·©ç§»å‹•ï¼Œçµ¦è‡ªå·±ä¸€æ¯å’–å•¡çš„æ™‚é–“ã€‚";
            return "<span>âœ¨</span>éœéœæ„Ÿå—ä»Šæ—¥æ°›åœã€‚";
        }

        function getWeatherIcon(weather) {
            if (!weather) return "ğŸŒ¤ï¸";
            if (weather.includes("æ™´")) return "â˜€ï¸";
            if (weather.includes("å¤šé›²")) return "â›…";
            if (weather.includes("é™°")) return "â˜ï¸";
            if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
            if (weather.includes("é›·")) return "â›ˆï¸";
            return "ğŸŒ¤ï¸";
        }

        // ä¿®æ­£:è™•ç†å¯èƒ½å¸¶æœ‰ % ç¬¦è™Ÿçš„é™é›¨æ©Ÿç‡
        function parseValue(value) {
            if (typeof value === 'string') {
                return value.replace('%', '').replace('Â°C', '').trim();
            }
            return value;
        }

        function getAdvice(rainProb, maxTemp) {
            const rain = parseInt(parseValue(rainProb));
            const temp = parseInt(parseValue(maxTemp));
            
            let rainText = "æ”¾å¿ƒå‡ºé–€å•¦";
            if (rain > 30) rainText = "è¨˜å¾—å¸¶å‚˜å“¦";
            
            let clothText = "èˆ’é©ç©¿æ­";
            if (temp >= 28) clothText = "çŸ­è¢–å‡ºç™¼";
            else if (temp <= 20) clothText = "åŠ ä»¶å¤–å¥—";
            
            return { rainText, clothText };
        }

        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "æ—©æ™¨";
            if (hour >= 11 && hour < 14) return "ä¸­åˆ";
            if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
            if (hour >= 18 && hour < 23) return "å¤œæ™š";
            return "æ·±å¤œ";
        }

        async function fetchWeather(city) {
            const API_URL = cityMap[city];
            try {
                const [_, json] = await Promise.all([
                    new Promise(r => setTimeout(r, 1000)),
                    fetch(API_URL).then(res => res.json())
                ]);
                
                console.log('API å›æ‡‰:', json); // é™¤éŒ¯ç”¨
                
                if (json.success) {
                    renderWeather(json.data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } else throw new Error("API Error");
            } catch (e) {
                console.error('éŒ¯èª¤è©³æƒ…:', e);
                alert("å¤©æ°£è³‡æ–™è®€å–å¤±æ•—ï¼è«‹ç¨å¾Œå†è©¦ã€‚");
                document.getElementById('loading').style.display = 'none';
            }
        }

        function renderWeather(data) {
            const forecasts = data.forecasts;
            const current = forecasts[0];
            const others = forecasts.slice(1);
            
            // ä¿®æ­£:è™•ç†æº«åº¦è³‡æ–™
            const minTemp = parseInt(parseValue(current.minTemp));
            const maxTemp = parseInt(parseValue(current.maxTemp));
            const avgTemp = Math.round((minTemp + maxTemp) / 2);
            
            const advice = getAdvice(current.rain, current.maxTemp);
            const mood = getMoodText(current.weather);
            const cityDisplay = document.getElementById("citySelect").options[document.getElementById("citySelect").selectedIndex].text.split(' ')[0];

            document.getElementById("heroCard").innerHTML = `
                <div class="hero-card" id="currentWeatherCard">
                    <div class="hero-period">${cityDisplay}ï¼Œæ­¤åˆ»çš„é¢¨æ™¯</div>
                    <div class="hero-temp-container">
                        <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                        <div class="hero-temp">${avgTemp}Â°</div>
                    </div>
                    <div class="hero-desc">${current.weather}</div>
                    <div class="mood-text">${mood}</div>
                    <div class="advice-grid">
                        <div class="advice-item">
                            <div class="advice-icon">â˜”</div>
                            <div class="advice-text">${advice.rainText}</div>
                        </div>
                        <div class="advice-item">
                            <div class="advice-icon">ğŸ‘š</div>
                            <div class="advice-text">${advice.clothText}</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('currentWeatherCard').classList.add('animate');

            const scrollContainer = document.getElementById("futureForecasts");
            scrollContainer.innerHTML = '';
            const todayDate = new Date().getDate();
            
            others.forEach(f => {
                let p = getTimePeriod(f.startTime);
                const fDate = new Date(f.startTime);
                if (fDate.getDate() !== todayDate) p = "æ˜æ—¥" + p;
                
                const fMinTemp = parseValue(f.minTemp);
                const fMaxTemp = parseValue(f.maxTemp);
                const fRain = parseValue(f.rain);
                
                scrollContainer.innerHTML += `
                    <div class="mini-card">
                        <div class="mini-time">${p}</div>
                        <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                        <div class="mini-temp">${fMinTemp}Â°-${fMaxTemp}Â°</div>
                        <div style="font-size:0.75rem;color:var(--secondary-color);margin-top:5px;font-family:'Noto Sans TC', sans-serif;">ğŸ’§æ©Ÿç‡ ${fRain}%</div>
                    </div>
                `;
            });

            scrollContainer.classList.add('animate');

            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const dayIndex = now.getDay();
            const days = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
            document.getElementById("updateTime").textContent = `${month}æœˆ${date}æ—¥ ${days[dayIndex]}`;
        }

        document.addEventListener("DOMContentLoaded", () => fetchWeather("taipei"));
        
        document.getElementById("citySelect").addEventListener("change", (e) => {
            document.getElementById('heroCard').innerHTML = '';
            document.getElementById('futureForecasts').innerHTML = '';
            document.getElementById('futureForecasts').classList.remove('animate');

            const selectedOption = e.target.options[e.target.selectedIndex];
            selectedOption.text = selectedOption.text.split(' ')[0] + ' - é§è¶³ä¸­â–¾';
            Array.from(e.target.options).forEach(opt => {
                if (opt !== selectedOption) {
                    opt.text = opt.text.split(' ')[0];
                }
            });

            document.getElementById('loading').style.display = 'flex';
            document.getElementById('mainContent').style.display = 'none';
            fetchWeather(e.target.value);
        });
    </script>
</body>

</html>